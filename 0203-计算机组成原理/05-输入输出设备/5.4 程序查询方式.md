# 程序查询方式流程

## 查询流程

- 检查状态标记：测试指令

- 准备就绪：转移指令

- 数据交换：传送指令

```mermaid
graph TB
  A[/开始/]-->D[检查状态标记]-->B{准备就绪}-->|是|数据交换-->C[/结束/]
  B-->|否|D
```

```mermaid
graph TB
  A[/开始/]
  Z[/结束/]
  C-->|否|D
  A-->D[检查状态标记1]-->B{设备1\n准备就绪}-..->|否|检查状态标记N-->C{设备N\n准备就绪}-->|是|处理设备N-->Z
  B-->|是|处理设备1-->Z
  
```

## 程序流程

保存寄存器内容

```mermaid
graph TD
  A[/开始/]  
  Z[/结束IO传送/]
  
  A-->设置计数值-->设置主存缓冲区首地址-->B[启动外设]-->C{准备好？}-->|是|传送一个数据-->修改主存地址-->修改计数器值-->D{传送完}-->|是|Z
  C-->|否|C
  D-->|否|B
```

# 程序查询方式接口电路

![image.png](../../attachments/png/5.4image.png)

以输入为例

1. CPU通过地址线给出外部设备的地址

2. 设备选择电路与地址线上的地址进行比较

3. SEL（选择设备）信号与启动命令信号有效

4. 将标志D（设备准备标志）置为0

5. 将标志B（设备忙标志）置为1，并启动设备

6. 设备将准备好的数据保存到DBR（数据缓冲区）中

7. 设备工作结束，发出结束信号

8. 将标志B（设备忙标志）置为0

9. 将标志D（设备准备标志）置为1，向CPU发出准备就绪信号

> 在整个过程中，CPU在原地踏步对D为1进行查询
