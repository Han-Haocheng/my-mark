# 公式与函数

## 公式

公式：以`=`开始。一般包含单元格引用、运算符、值或常量、函数等几种元素
- 当公式引用的单元格的数据修改后，公式的计算结果会自动更新


### 算数运算符
**算数运算符**

| 符号  | 含义  |
| --- | --- |
| `+` | 加法  |
| `-` | 减法  |
| `*` | 乘法  |
| `/` | 除法  |
| `%` | 百分比 |
| `^` | 乘方  |
### 比较运算符

**比较运算符**：用于比较两个值，结果为逻辑值

| 符号   | 含义  |
| ---- | --- |
| `=`  | 等于  |
| `<`  | 小于  |
| `>`  | 大于  |
| `<=` | 不大于 |
| `>=` | 不小于 |
| `<>` | 不等于 |

### 文本运算符
- 链接运算符(`&`)：用于拼接两个字符串
- 汉字和字母：需要加双引号


### 引用运算符

- 区域运算符(`:`)：用于合并多个单元格区域
- 联合运算符(`,`)：用于将多个引用合并为一个引用--并集
- 交叉运算符(` `)：产生同时属于两个引用的单元格区域的引用--交集

>[!faq]+  例题：1.在Excel中，单元格区域A2:C3，A3:E3包含 8 个单元格。(填空)

>[!faq]+  例题：2.Excel2016中，在单元格内输入“＝2025-01-01”所显示的结果为(A)。
>- A.2023
>- B.2025-01-01
>- C.2025年1月1日
>- D.2025-1-1


### 公式的运算顺序

1. 先算括号内部
2. 引用运算>算数运算>文本运算>比较运算
3. 从左到右运算

### 公式输入和修改

- 直接在单元格
- 利用编辑栏

### 相同工作表单元格引用

- **相对引用**：单元格地址在*复制*后，会随公式所在位置的变化而改变
	- 移动公式后单元格地址不变
- **绝对引用**：地址不随公式位置的改变而发生改变
	- 形式：在列表和行号前添加`$`符号
	- 删除或插入行列时会影响公式
	- 快捷键：`F4`
- **混合引用**：地址部分是相对引用部分是绝对引用



>[!faq]+  例题:在Excel工作表单元格中输入公式的时候，`B3`的单元格引用地址方式，称为()

>[!faq]+  例题:如果将`B3`单元格中的公式`=C3+$D5`复制到同一工作表的`D7`单元格中该单元格的公式为(C)
>- A.`=C3+$D5`
>- B.`=C7+$D9`
>- C.`=E7+$D9`
>- D.`=E7+$D5`

>[!faq]+  例题:已知`D5`单元格中的公式为 `=D1-$C$4`，删除第2行，然后在第一列的右端插入一列，则`E4`单元格中的公式为 `=D1-$D$3`

### 三维地址引用

三维地址引用：跨工作表的单元格地址引用
- 同工作簿不同工作表单元格引用格式：`工作表名!单元格引用`
- 不同工作簿不同工作表间单元格三维引用格式：`[工作簿名]工作表名!单元格引用`


## 函数

函数：按数学方法预先定义好的一种特定计算格式，是公式计算的另一种表达形式
- 函数的组成：函数一般由函数名和参数组成
- 函数的一般格式：`函数名([参数1],[参数2],...)`
- 函数中的参数类型：可以是常量、单元格地址、数组、已定义的名称、公式、函数等
- 输入函数时必须以等号`＝`开始


### 函数的输入

- 直接输入函数名
- 利用`插入函数`对话框
	- 方式一：单击 按钮组-》插入函数按钮

### 公式或函数中常见的出错信息

| 错误值       | 错误值出现原因 | 错误值       | 错误值出现原因        |
| --------- | ------- | --------- | -------------- |
| `#DIV/O!` | 除数为0    | `#NUM!`   | 公式或函数中含无效数值或参数 |
| `#N/A`    | 没有可用的数值 | `#REF!`   | 单元格引用无效        |
| `#NAME?`  | 不能识别的名字 | `#VALUE!` | 不正确的参数或运算符     |
| `#NULL!`  | 交集为空    | `#####`   | 单元格宽度不够        |

### 常用函数

#### 求和

```excel
SUM(值,...)
```

- 参数
	- `值...`：被求和的数值或引用
- 特殊情况
	- 引用类型的位置必须为数值型
	- 能转为数值型的参数都会参与运算


#### 单条件求和


```excel
SUMIF(条件区,条件式,[求合区])
```


- 参数
	- `条件区`：用于条件判断的区域
	- `条件式`：用于进行逻辑判断
		- 当条件为*非数字或引用型*时，用`"`包围
	- `[求合区]`：用于求和的区域，
		- 省略时，求和区域为条件区域

#### 多条件求和


```excel
SUMIFS(求合区,条件区,条件式...)
```

- 参数
	- `求合区`：用于求和的区域
	- `条件区`：用于条件判断的区域
	- `条件式...`：用于进行逻辑判断
		- 需要同时满足要求条件

#### 求平均值

```excel
AVERAGE(值...)
```

- 参数
	- `值...`：要求平均的值
		- 可变参数最多为255个


#### 单条件求平均值

```excel
AVERAGEIF(条件区,条件式,[求合区])
```

- 参数
	- `条件区`：用于条件判断的区域
	- `条件式`：用于进行逻辑判断
		- 当条件为*非数字或引用型*时，用`"`包围
	- `[求合区]`：用于求和的区域，
		- 省略时，求和区域为条件区域

#### 多条件求平均值


```excel
AVERAGEIFS(求合区,条件区,条件式...)
```

- 参数
	- `求合区`：用于求和的区域
	- `条件区`：用于条件判断的区域
	- `条件式...`：用于进行逻辑判断
		- 需要同时满足要求条件

#### 计数


```excel
COUNT(值[,值...])
```

计数：用于统计指定区域单元格的个数
- 参数
	- `值`：要统计的范围

#### 单条件计数


```excel
COUNTIF(条件区，条件式)
```

- 参数
	- `条件区`：所统计区域范围
	- `条件式`：统计的条件
		- 当条件为*非数字或引用型*时，用`"`包围
#### 多条件计数

```excel
COUNTIFS(条件区,条件式[,条件区，条件式...])
```


- 参数
	- `条件区`：所统计区域范围
	- `条件式`：统计的条件
		- 只统计同时满足要求条件
		- 当条件为*非数字或引用型*时，用`"`包围

>[!faq]+  例题：1.在Excel 2016中，单元格`C1`到`C10`分别存放了10位同学的考试成绩，下列用于计算考试成绩在80分以上的人数的公式是(C)(单选)
>- A.`=COUNT(C1:C10, ">80")`
>- B.`=COUNT(C1:C10, >80)`
>- C.`=COUNTIF(C1:C10, ">80")`
>- D.`=COUNTIF(C1:C10,>80)`


#### 排位
```excel
RANK(值,区域[,排序方式])
RANK.EQ(值,区域[,排序方式])
```

**排位**：如果存在相同排位，重复排序不会影响总排名数
- 参数
	- `值`：排序的依据
	- `区域`：要排序的比较范围
		- 最好使用绝对引用
	- `[,排序方式]`：默认0--降序，非0--升序

#### 最大值


```excel
MAX(值[,值...])
```

计数：求区域中最大值
- 参数
	- `值`：要求的范围

#### 最小值


```excel
MIN(value_1,[value_2],...)
```

计数：求区域中最小值
- 参数
	- `value`：值，要求的范围


#### 逻辑判断

```excel
IF(logical_test,[true_value],[false_value]])
```
逻辑判断：用于判断
- 参数
	- `logical_test`：条件式判断条件
		- *不需要使用双引号*
	- `true_value`：判断为真的值
		- 默认值：`TRUE`
	- `false_value`：判断为假的值
		- 默认值：`FALSE`
- 特殊格式
	- 最多可以嵌套64个
>[!faq]+  例题：1.Excel中，设E列单元格存放工资总额，F列用以存放实发工资，其中当$工资总额>1600$时，$实发工资-工资-(工资总额-1600)\times税率$；当$工资总额\leq1600$时，$实发工资=工资总额$。设$税率=0.05$。则`F`列可根据公式实现。其中`F2`的公式应为(C)(单选)
>- A.`=IF("E2＞1600",E2-(E2-1600)*0.05,E2)`
>- B.`=IF(E2＞1600,E2,E2-(E2-1600)*0.05)`
>- C.`=IF(E2＞1600,E2-(E2-1600)*0.05,E2)`
>- D.`=IF("E2＞1600", E2,E2-(E2-1600)*0.05)`


#### 逻辑“与”函数

```excel
AND(logical_1,[logical_2],...)
```

- 功能：当所有条件式都取`TRUE`，函数取值`TRUE`，否则取`FALSE`
- 参数
	- `logical`：条件式，判断条件

#### 逻辑“或”函数

```excel
OR(logical_1,[logical_2],...)
```

- 功能：只有条件式全取`FALSE`时，函数取值`FALSE`，否则取`TRUE`
- 参数
	- `logical`：条件式，判断条件


#### 取字符串子串函数

```excel
LEFT(text,num_chars)
RIGHT(text,num_chars)
MID(text,start_num,num_chars)
```

- 功能
	- 从文本字符串最左边开始返回指定个数的字符，也就是最前面的一个或几个字符
	- 从文本字符串最右边开始返回指定个数的字符，也就是最后面的一个或几个字符
	- 从文本字符串中的指定位置开始返回特定个数的字符。
- 参数
	- `text`：选中文本
	- `start_num`：开始位置
	- `num_chars`：字符个数


>[!faq]+  例题：1.（单选）在Excel 2016某单元格中输入公式`＝LEFT(RIGHT("ABCDEF",4),2)`，然后回车，该单元格中显示的数据为（C）
>A.ABCD B.ABC C.CD D.CDE


>[!faq]+  例题：2.现需要在“班级”列填入班级名如（01班，02班等），学号的第7，8位表示班级号，下列操作正确的是（）
A.在C2单元格输入＝Mid（A2，7，8）＆“班”，拖动C2单元格填充柄向下填充
B.在C2单元格输入＝Mid（A2，7，8）＋“班”，拖动C2单元格填充柄向下填充
C.在C2单元格输入＝Right（left（A2，8），2）＆“班”，拖动C2单元格填充柄向下填充
D.在C2单元格输入＝Right（left（A2，8），2）＋“班”，拖动C2单元格填充柄向下填充

|            |     |     |     |
| ---------- | --- | --- | --- |
| 2202100102 |     |     | 80  |
|            |     |     |     |

#### 垂直查询函数
```excel
VLOOKUP(lookup_value,table_array,col_index_num,[range_lookup])
```

- 功能：搜索指定单元格区域的*第一列*，然后返回该区域*相同行上任何指定*单元格中的值
- 参数
	- `lookup_value`：索引，拿谁搜索
	- `table_array`：搜索区，用于搜索的范围
		- 第一列是与索引一致的字段
		- 通常是绝对引用
	- `col_index_num`：要获取第几列上的值
	- `[range_lookup]`：查找方式
		- `0`或`false`：表示精确匹配
		- `1`或`true`：省略，但搜索区的第一列必须升序排序，表示能近似匹配。

>[!faq]+ 例题：1.现需要根据“档案”表的数据（数据区域为`A1:C101`）使用`Vlookup()`函数填写“姓名”列数据，下列操作可行的是（A）
> - A.在`B2`单元格输入“`＝Vlookup（A2，档案！＄A＄1:＄C＄101，2，0）`”，拖动B2单元格填充柄向下填充。
> - B.在`B2`单元格输入“`＝Vlookup（A2，档案！A1:C101，2，0）`”，拖动B2单元格填充柄向下填充。
> - C.在`B2`单元格输入“`＝Vlookup（A2，档案！＄A＄1:C＄101，3，0）`”，拖动B2单元格填充柄向下填充。
> - D.在`B2`单元格输入“`＝Vlookup（A2，档案！A1:C101，3，0）`”，拖动B2单元格填充柄向下填充。


#### 提取日期各部分的函数


```excel
YEAR(serial_number)
MONTH(serial_number)
DAY(serial_number)
WEEKDAY(serial_number,[return_type])
```
- `serial_number`：一个日期数据或一个单元格引用
	- 日期数据是字符串，需要用双引号
- `return_type`：返回的星期格式


#### 获取当前日期和时间的函数

```excel
TODAY()
NOW()
```

- 功能
	- `TODAY()`：返回当前计算机系统的日期
	- `NOW()`：返回当前计算机系统的日期和时间


#### 获取单元格行号和列号的函数
```excel
ROW([reference])
COLUMN([reference])
```
- 参数：
	- `[reference]`：需要得到其行号的单元格或单元格区域
		- 省略代表当前单元格

#### 向下取整函数

```excel
INT(num)
```

- 功能：向下取整，将小数取整为不大于它的最大整数（不四舍五入），结果总是小于等于原值。
- 参数
	- `num`：一个数值或单元格引用

#### 四舍五入函数ROUND

```excel
ROUND(number, num_digits)
```

- `number`：要四舍五入的数字
- `num_digits`：要进行四舍五入运算的位数


#### 求余数函数


```excel
MOD(number, divisor)
```

- 功能：求两个数相除的余数
- 参数
	- `number`：要计算余数的被除数
	- `Divisor`：除数
