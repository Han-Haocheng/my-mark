# 虚拟机

## 虚拟机的基本概念

虚拟机管理程序(虚拟机监控程序/Virtual Machine Monitor/Hypervisor)：使用虚拟化技术，将一台物理机器虚拟化为多台虚拟机器（Virtual Machine/VM），每个虚拟机器都可以独立运行一个操作系统

- 常用的虚拟机软件
  - VirtualBox
  - VMware

### 第一类VMM直接运行在硬件上

![20240806152704.png](../../attachment/png/Pasted%20image%2020240806152704.png)

### 第二类VMM运行中宿主操作系统上

![20240806152714.png](../../attachment/png/Pasted%20image%2020240806152714.png)

|                    | 第一类VMM| 第二类VMM|
| ------------------ | ------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------- |
| 对物理资源的控制权 | 直接运行在硬件之上,能直接控制和分配物理资源| 运行在HostOS之上,依赖于HostOS为其分配物理资源|
| 资源分配方式       | 在安装GuestOS时,VMM要在原本的硬盘上自行分配存储空间,类似于"外核"的分配方式,分配未经抽象的物理硬件 | GuestOS拥有自己的虚拟磁盘,该盘实际上是 Host OS文件系统中的一个大文件。GuestOS分 配到的内存是虚拟内存 |
| 性能| 性能更好| 性能更差,需要HostOS作为"中介"|
| 可支持的虚拟机数量 | 更多,不需要和Host OS竞争资源,相同的硬件资源可以支持更多的虚拟机| 更少，Host OS 本身需要使用物理资源,Host OS上运行的其他进程也需要物理资源|
| 虚拟机的可迁移性   |     更差|  更好,只需导出虚拟机镜像文件即可迁移到另一 台HostOS 上,商业化应用更广泛                                                                                                    |
|    运行模式|第一类VMM运行在最高特权级(Ring 0),可以执行最高特权的指令|第二类VMM部分运行在用户态、部分运行在内核态。GuestOS发出的系统调用会被VMM截获, 并转化为VMM对HostOS的系统调用|

> [!tip] 提示
> 支持虚拟化的CPU通常分更多指令等级
